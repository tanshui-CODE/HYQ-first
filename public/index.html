<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å››å·åç‰è½¦è¾†æ¿ç°§æœ‰é™å…¬å¸ - å¤–è´¸å®¢æˆ·ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .sidebar-item.active { background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%); }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .fade-in { animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal { backdrop-filter: blur(4px); }
    .login-left {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%);
      position: relative;
      overflow: hidden;
    }
    .login-left::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      animation: rotate 60s linear infinite;
    }
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .float-animation {
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    .pulse-ring {
      animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
    }
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    .input-group {
      position: relative;
    }
    .input-group input:focus + .input-icon {
      color: #3b82f6;
      transform: scale(1.1);
    }
    .input-icon {
      transition: all 0.3s ease;
    }
    .btn-login {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      transition: all 0.3s ease;
    }
    .btn-login:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
    }
    .globe-icon {
      animation: spin 20s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="app">
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage" class="min-h-screen flex">
      <!-- å·¦ä¾§å“ç‰ŒåŒºåŸŸ -->
      <div class="login-left hidden lg:flex lg:w-1/2 flex-col justify-center items-center text-white p-12 relative z-10">
        <div class="float-animation mb-8">
          <img src="/logo.png" alt="åç‰æ¿ç°§" class="w-48 h-48 object-contain drop-shadow-2xl">
        </div>
        <h1 class="text-4xl font-bold mb-4 text-center">SICHUAN HUAYU</h1>
        <h2 class="text-2xl font-light mb-6 text-center">VEHICLE LEAF SPRING CO., LTD.</h2>
        <p class="text-xl text-blue-200 text-center max-w-md">Professional Automotive Leaf Spring Manufacturer Since 1992</p>
        <div class="mt-12 flex items-center gap-8 text-blue-200">
          <div class="text-center">
            <i class="fas fa-globe globe-icon text-3xl mb-2"></i>
            <p class="text-sm">Global Export</p>
          </div>
          <div class="text-center">
            <i class="fas fa-industry text-3xl mb-2"></i>
            <p class="text-sm">30,000 Tons/Year</p>
          </div>
          <div class="text-center">
            <i class="fas fa-award text-3xl mb-2"></i>
            <p class="text-sm">ISO Certified</p>
          </div>
        </div>
      </div>
      <!-- å³ä¾§ç™»å½•åŒºåŸŸ -->
      <div class="w-full lg:w-1/2 flex items-center justify-center bg-gray-50 p-8">
        <div class="w-full max-w-md">
          <div class="text-center mb-8 lg:hidden">
            <img src="/logo.png" alt="åç‰æ¿ç°§" class="w-24 h-24 mx-auto mb-4 object-contain">
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome Back</h2>
          <p class="text-gray-500 mb-8">Sign in to your CRM account</p>
          <form onsubmit="handleLogin(event)">
            <div class="mb-5">
              <label class="block text-gray-600 text-sm font-medium mb-2">Username</label>
              <div class="relative">
                <input type="text" id="loginUsername" required class="w-full px-4 py-3 pl-11 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition" placeholder="Enter your username">
                <i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>
            <div class="mb-6">
              <label class="block text-gray-600 text-sm font-medium mb-2">Password</label>
              <div class="relative">
                <input type="password" id="loginPassword" required class="w-full px-4 py-3 pl-11 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition" placeholder="Enter your password">
                <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>
            <button type="submit" class="btn-login w-full text-white py-3 rounded-xl font-semibold text-lg">
              <i class="fas fa-sign-in-alt mr-2"></i>Sign In
            </button>
          </form>
          <div class="mt-8 pt-6 border-t border-gray-200 text-center">
            <p class="text-gray-400 text-sm">å››å·åç‰è½¦è¾†æ¿ç°§æœ‰é™å…¬å¸</p>
            <p class="text-gray-400 text-xs mt-1">å¤–è´¸å®¢æˆ·ç®¡ç†ç³»ç»Ÿ</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="mainApp" class="hidden">
      <!-- ä¾§è¾¹æ  -->
      <div class="fixed left-0 top-0 h-full w-64 bg-gray-900 text-white z-50">
        <div class="p-6 border-b border-gray-700">
          <h1 class="text-lg font-bold flex items-center">
            <i class="fas fa-industry mr-2"></i>åç‰æ¿ç°§CRM
          </h1>
          <p class="text-gray-400 text-sm mt-1">å¤–è´¸å®¢æˆ·ç®¡ç†ç³»ç»Ÿ</p>
        </div>
        <nav class="p-4">
          <div onclick="showPage('dashboard')" class="sidebar-item active flex items-center px-4 py-3 rounded-lg cursor-pointer mb-2 hover:bg-gray-800 transition">
            <i class="fas fa-chart-line w-6"></i><span>æ•°æ®çœ‹æ¿</span>
          </div>
          <div onclick="showPage('customers')" class="sidebar-item flex items-center px-4 py-3 rounded-lg cursor-pointer mb-2 hover:bg-gray-800 transition">
            <i class="fas fa-users w-6"></i><span>å®¢æˆ·ç®¡ç†</span>
          </div>
          <div onclick="showPage('products')" class="sidebar-item flex items-center px-4 py-3 rounded-lg cursor-pointer mb-2 hover:bg-gray-800 transition">
            <i class="fas fa-box w-6"></i><span>äº§å“ç®¡ç†</span>
          </div>
          <div onclick="showPage('orders')" class="sidebar-item flex items-center px-4 py-3 rounded-lg cursor-pointer mb-2 hover:bg-gray-800 transition">
            <i class="fas fa-shopping-cart w-6"></i><span>è®¢å•ç®¡ç†</span>
          </div>
          <div onclick="showPage('inquiries')" class="sidebar-item flex items-center px-4 py-3 rounded-lg cursor-pointer mb-2 hover:bg-gray-800 transition">
            <i class="fas fa-envelope w-6"></i><span>è¯¢ç›˜ç®¡ç†</span>
          </div>
          <div onclick="showPage('ai')" class="sidebar-item flex items-center px-4 py-3 rounded-lg cursor-pointer mb-2 hover:bg-gray-800 transition">
            <i class="fas fa-robot w-6"></i><span>AIåŠ©æ‰‹</span>
          </div>
        </nav>
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700">
          <div class="flex items-center justify-between">
            <div>
              <p class="font-semibold" id="userName">ç®¡ç†å‘˜</p>
              <p class="text-gray-400 text-sm">åœ¨çº¿</p>
            </div>
            <button onclick="logout()" class="text-gray-400 hover:text-white transition">
              <i class="fas fa-sign-out-alt text-xl"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- ä¸»å†…å®¹åŒº -->
      <div class="ml-64 p-8">
        <!-- æ•°æ®çœ‹æ¿ -->
        <div id="dashboardPage" class="page">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">æ•°æ®çœ‹æ¿</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 card-hover transition">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">å®¢æˆ·æ€»æ•°</p>
                  <p class="text-3xl font-bold text-gray-800" id="statCustomers">0</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-users text-blue-600 text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-white rounded-xl p-6 card-hover transition">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">è®¢å•æ€»æ•°</p>
                  <p class="text-3xl font-bold text-gray-800" id="statOrders">0</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-shopping-cart text-green-600 text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-white rounded-xl p-6 card-hover transition">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">å¾…å¤„ç†è¯¢ç›˜</p>
                  <p class="text-3xl font-bold text-gray-800" id="statInquiries">0</p>
                </div>
                <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-envelope text-yellow-600 text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-white rounded-xl p-6 card-hover transition">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">å¾…å¤„ç†è®¢å•</p>
                  <p class="text-3xl font-bold text-gray-800" id="statPending">0</p>
                </div>
                <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-clock text-red-600 text-xl"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">æœ€è¿‘è®¢å•</h3>
              <div id="recentOrders" class="space-y-3"></div>
            </div>
            <div class="bg-white rounded-xl p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">æœ€è¿‘è¯¢ç›˜</h3>
              <div id="recentInquiries" class="space-y-3"></div>
            </div>
          </div>
        </div>

        <!-- å®¢æˆ·ç®¡ç† -->
        <div id="customersPage" class="page hidden">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">å®¢æˆ·ç®¡ç†</h2>
            <button onclick="showCustomerModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
              <i class="fas fa-plus mr-2"></i>æ·»åŠ å®¢æˆ·
            </button>
          </div>
          <div class="bg-white rounded-xl p-6">
            <div class="flex gap-4 mb-4">
              <input type="text" id="customerSearch" placeholder="æœç´¢å®¢æˆ·åç§°/å…¬å¸/é‚®ç®±..." class="flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" onkeyup="loadCustomers()">
              <select id="customerStatus" class="px-4 py-2 border rounded-lg" onchange="loadCustomers()">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="active">æ´»è·ƒ</option>
                <option value="inactive">ä¸æ´»è·ƒ</option>
                <option value="potential">æ½œåœ¨</option>
              </select>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-gray-600">å®¢æˆ·åç§°</th>
                    <th class="px-4 py-3 text-left text-gray-600">å…¬å¸</th>
                    <th class="px-4 py-3 text-left text-gray-600">å›½å®¶</th>
                    <th class="px-4 py-3 text-left text-gray-600">ç±»å‹</th>
                    <th class="px-4 py-3 text-left text-gray-600">ç­‰çº§</th>
                    <th class="px-4 py-3 text-left text-gray-600">çŠ¶æ€</th>
                    <th class="px-4 py-3 text-left text-gray-600">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody id="customerList"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- äº§å“ç®¡ç† -->
        <div id="productsPage" class="page hidden">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">äº§å“ç®¡ç†</h2>
            <button onclick="showProductModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
              <i class="fas fa-plus mr-2"></i>æ·»åŠ äº§å“
            </button>
          </div>
          <div class="bg-white rounded-xl p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="productList"></div>
          </div>
        </div>

        <!-- è®¢å•ç®¡ç† -->
        <div id="ordersPage" class="page hidden">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">è®¢å•ç®¡ç†</h2>
            <button onclick="showOrderModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
              <i class="fas fa-plus mr-2"></i>åˆ›å»ºè®¢å•
            </button>
          </div>
          <div class="bg-white rounded-xl p-6">
            <div class="flex gap-4 mb-4">
              <select id="orderStatus" class="px-4 py-2 border rounded-lg" onchange="loadOrders()">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="pending">å¾…å¤„ç†</option>
                <option value="confirmed">å·²ç¡®è®¤</option>
                <option value="producing">ç”Ÿäº§ä¸­</option>
                <option value="shipped">å·²å‘è´§</option>
                <option value="completed">å·²å®Œæˆ</option>
              </select>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-gray-600">è®¢å•å·</th>
                    <th class="px-4 py-3 text-left text-gray-600">å®¢æˆ·</th>
                    <th class="px-4 py-3 text-left text-gray-600">äº§å“</th>
                    <th class="px-4 py-3 text-left text-gray-600">æ•°é‡</th>
                    <th class="px-4 py-3 text-left text-gray-600">é‡‘é¢</th>
                    <th class="px-4 py-3 text-left text-gray-600">çŠ¶æ€</th>
                    <th class="px-4 py-3 text-left text-gray-600">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody id="orderList"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- è¯¢ç›˜ç®¡ç† -->
        <div id="inquiriesPage" class="page hidden">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">è¯¢ç›˜ç®¡ç†</h2>
            <button onclick="showInquiryModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
              <i class="fas fa-plus mr-2"></i>æ·»åŠ è¯¢ç›˜
            </button>
          </div>
          <div class="bg-white rounded-xl p-6">
            <div class="flex gap-4 mb-4">
              <select id="inquiryStatus" class="px-4 py-2 border rounded-lg" onchange="loadInquiries()">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="new">æ–°è¯¢ç›˜</option>
                <option value="processing">å¤„ç†ä¸­</option>
                <option value="quoted">å·²æŠ¥ä»·</option>
                <option value="closed">å·²å…³é—­</option>
              </select>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-gray-600">è¯¢ç›˜ç¼–å·</th>
                    <th class="px-4 py-3 text-left text-gray-600">å®¢æˆ·</th>
                    <th class="px-4 py-3 text-left text-gray-600">äº§å“</th>
                    <th class="px-4 py-3 text-left text-gray-600">æ•°é‡</th>
                    <th class="px-4 py-3 text-left text-gray-600">çŠ¶æ€</th>
                    <th class="px-4 py-3 text-left text-gray-600">æ—¥æœŸ</th>
                    <th class="px-4 py-3 text-left text-gray-600">æ“ä½œ</th>
                  </tr>
                </thead>
                <tbody id="inquiryList"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- AIåŠ©æ‰‹ -->
        <div id="aiPage" class="page hidden">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">AIæ™ºèƒ½åŠ©æ‰‹</h2>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
              <div class="bg-white rounded-xl p-6 h-[600px] flex flex-col">
                <div class="flex items-center gap-3 pb-4 border-b">
                  <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-robot text-white"></i>
                  </div>
                  <div>
                    <h3 class="font-semibold">åç‰AIåŠ©æ‰‹</h3>
                    <p class="text-sm text-gray-500">åŸºäºDeepSeekå¤§æ¨¡å‹</p>
                  </div>
                </div>
                
                <div id="aiChatMessages" class="flex-1 overflow-y-auto py-4 space-y-4">
                  <div class="flex gap-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-3 max-w-[80%]">
                      <p class="text-gray-700">æ‚¨å¥½ï¼æˆ‘æ˜¯åç‰AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨åˆ†æå®¢æˆ·æ•°æ®ã€è®¢å•æƒ…å†µå’Œä¸šåŠ¡è¶‹åŠ¿ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ</p>
                    </div>
                  </div>
                </div>
                
                <div class="pt-4 border-t">
                  <div class="flex gap-2">
                    <input type="text" id="aiInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šåˆ†æä¸€ä¸‹å®¢æˆ·åˆ†å¸ƒæƒ…å†µ" 
                      class="flex-1 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                      onkeypress="if(event.key==='Enter')sendAIMessage()">
                    <button onclick="sendAIMessage()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:opacity-90 transition">
                      <i class="fas fa-paper-plane"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="space-y-6">
              <div class="bg-white rounded-xl p-6">
                <h3 class="font-semibold mb-4"><i class="fas fa-key mr-2 text-blue-500"></i>APIè®¾ç½®</h3>
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm text-gray-600 mb-1">DeepSeek API Key</label>
                    <input type="password" id="deepseekApiKey" placeholder="sk-xxxxxxxxxxxxxxxx" 
                      class="w-full px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                  </div>
                  <button onclick="saveApiKey()" class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                    ä¿å­˜API Key
                  </button>
                </div>
              </div>
              
              <div class="bg-white rounded-xl p-6">
                <h3 class="font-semibold mb-4"><i class="fas fa-lightbulb mr-2 text-yellow-500"></i>å¿«æ·æé—®</h3>
                <div class="space-y-2">
                  <button onclick="quickAsk('åˆ†æä¸€ä¸‹å®¢æˆ·åˆ†å¸ƒæƒ…å†µ')" class="w-full text-left px-3 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition text-sm">
                    ğŸ“Š åˆ†æå®¢æˆ·åˆ†å¸ƒæƒ…å†µ
                  </button>
                  <button onclick="quickAsk('å“ªäº›å®¢æˆ·æœ€è¿‘æ²¡æœ‰è·Ÿè¿›')" class="w-full text-left px-3 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition text-sm">
                    ğŸ” æŸ¥æ‰¾éœ€è¦è·Ÿè¿›çš„å®¢æˆ·
                  </button>
                  <button onclick="quickAsk('åˆ†æè®¢å•è¶‹åŠ¿å’Œé”€å”®é¢')" class="w-full text-left px-3 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition text-sm">
                    ğŸ“ˆ åˆ†æè®¢å•è¶‹åŠ¿
                  </button>
                  <button onclick="quickAsk('ç»™æˆ‘ä¸€äº›å®¢æˆ·å¼€å‘å»ºè®®')" class="w-full text-left px-3 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition text-sm">
                    ğŸ’¡ å®¢æˆ·å¼€å‘å»ºè®®
                  </button>
                  <button onclick="quickAsk('åˆ†æè¯¢ç›˜è½¬åŒ–ç‡')" class="w-full text-left px-3 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition text-sm">
                    ğŸ“‹ åˆ†æè¯¢ç›˜è½¬åŒ–ç‡
                  </button>
                </div>
              </div>
              
              <div class="bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl p-6 text-white">
                <h3 class="font-semibold mb-2"><i class="fas fa-info-circle mr-2"></i>AIèƒ½åŠ›è¯´æ˜</h3>
                <ul class="text-sm space-y-1 text-blue-100">
                  <li>â€¢ åˆ†æå®¢æˆ·æ•°æ®å’Œç”»åƒ</li>
                  <li>â€¢ é¢„æµ‹é”€å”®è¶‹åŠ¿</li>
                  <li>â€¢ æä¾›ä¸šåŠ¡å»ºè®®</li>
                  <li>â€¢ è§£ç­”äº§å“é—®é¢˜</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å®¢æˆ·æ¨¡æ€æ¡† -->
    <div id="customerModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 fade-in">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold" id="customerModalTitle">æ·»åŠ å®¢æˆ·</h3>
          <button onclick="closeCustomerModal()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <form onsubmit="saveCustomer(event)">
          <input type="hidden" id="customerId">
          <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">å®¢æˆ·åç§° *</label>
              <input type="text" id="customerName" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">å…¬å¸åç§°</label>
              <input type="text" id="customerCompany" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å›½å®¶ *</label>
              <input type="text" id="customerCountry" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">çŠ¶æ€</label>
              <select id="customerStatusInput" class="w-full px-3 py-2 border rounded-lg">
                <option value="potential">æ½œåœ¨</option>
                <option value="active">æ´»è·ƒ</option>
                <option value="inactive">ä¸æ´»è·ƒ</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å®¢æˆ·ç±»å‹</label>
              <select id="customerTypeInput" class="w-full px-3 py-2 border rounded-lg">
                <option value="">è¯·é€‰æ‹©</option>
                <option value="distributor">åˆ†é”€å•†</option>
                <option value="chassis">åº•ç›˜å•†</option>
                <option value="manufacturer">åˆ¶é€ å•†</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å®¢æˆ·ç­‰çº§</label>
              <select id="customerLevelInput" class="w-full px-3 py-2 border rounded-lg">
                <option value="">è¯·é€‰æ‹©</option>
                <option value="A">Açº§ (æ ¸å¿ƒå®¢æˆ·)</option>
                <option value="B">Bçº§ (é‡è¦å®¢æˆ·)</option>
                <option value="C">Cçº§ (æ™®é€šå®¢æˆ·)</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">é‚®ç®±</label>
              <input type="email" id="customerEmail" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">ç”µè¯</label>
              <input type="text" id="customerPhone" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">åœ°å€</label>
              <input type="text" id="customerAddress" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">å¤‡æ³¨</label>
              <textarea id="customerNotes" rows="2" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" onclick="closeCustomerModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ä¿å­˜</button>
          </div>
        </form>
      </div>
    </div>

    <!-- äº§å“æ¨¡æ€æ¡† -->
    <div id="productModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 fade-in">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold" id="productModalTitle">æ·»åŠ äº§å“</h3>
          <button onclick="closeProductModal()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <form onsubmit="saveProduct(event)">
          <input type="hidden" id="productId">
          <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">äº§å“åç§° *</label>
              <input type="text" id="productName" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">äº§å“ç±»åˆ«</label>
              <select id="productCategory" class="w-full px-3 py-2 border rounded-lg">
                <option value="é‡å‹è½¦ç³»åˆ—">é‡å‹è½¦ç³»åˆ—</option>
                <option value="è½»å‹è½¦ç³»åˆ—">è½»å‹è½¦ç³»åˆ—</option>
                <option value="å®¢è½¦ç³»åˆ—">å®¢è½¦ç³»åˆ—</option>
                <option value="æŒ‚è½¦ç³»åˆ—">æŒ‚è½¦ç³»åˆ—</option>
                <option value="å·¥ç¨‹è½¦ç³»åˆ—">å·¥ç¨‹è½¦ç³»åˆ—</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">æè´¨è§„æ ¼</label>
              <input type="text" id="productSpec" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">åšåº¦èŒƒå›´</label>
              <input type="text" id="productThickness" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å®½åº¦èŒƒå›´</label>
              <input type="text" id="productWidth" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">äº§å“æè¿°</label>
              <textarea id="productDescription" rows="2" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" onclick="closeProductModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ä¿å­˜</button>
          </div>
        </form>
      </div>
    </div>

    <!-- è®¢å•æ¨¡æ€æ¡† -->
    <div id="orderModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 fade-in">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold">åˆ›å»ºè®¢å•</h3>
          <button onclick="closeOrderModal()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <form onsubmit="saveOrder(event)">
          <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">å®¢æˆ· *</label>
              <select id="orderCustomer" required class="w-full px-3 py-2 border rounded-lg"></select>
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">äº§å“ *</label>
              <select id="orderProduct" required class="w-full px-3 py-2 border rounded-lg"></select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">æ•°é‡ *</label>
              <input type="number" id="orderQuantity" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å•ä½</label>
              <select id="orderUnit" class="w-full px-3 py-2 border rounded-lg">
                <option value="å¨">å¨</option>
                <option value="å¥—">å¥—</option>
                <option value="ä»¶">ä»¶</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å•ä»·(USD)</label>
              <input type="number" id="orderPrice" step="0.01" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">æ€»é‡‘é¢(USD)</label>
              <input type="number" id="orderAmount" step="0.01" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">å¤‡æ³¨</label>
              <textarea id="orderNotes" rows="2" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" onclick="closeOrderModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">åˆ›å»º</button>
          </div>
        </form>
      </div>
    </div>

    <!-- è¯¢ç›˜æ¨¡æ€æ¡† -->
    <div id="inquiryModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 fade-in">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold">æ·»åŠ è¯¢ç›˜</h3>
          <button onclick="closeInquiryModal()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <form onsubmit="saveInquiry(event)">
          <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">å®¢æˆ· *</label>
              <select id="inquiryCustomer" required class="w-full px-3 py-2 border rounded-lg"></select>
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">äº§å“ *</label>
              <select id="inquiryProduct" required class="w-full px-3 py-2 border rounded-lg"></select>
            </div>
            <div>
              <label class="block text-gray-700 mb-1">æ•°é‡</label>
              <input type="number" id="inquiryQuantity" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>
            <div>
              <label class="block text-gray-700 mb-1">å•ä½</label>
              <select id="inquiryUnit" class="w-full px-3 py-2 border rounded-lg">
                <option value="å¨">å¨</option>
                <option value="å¥—">å¥—</option>
                <option value="ä»¶">ä»¶</option>
              </select>
            </div>
            <div class="col-span-2">
              <label class="block text-gray-700 mb-1">è¯¢ç›˜å†…å®¹</label>
              <textarea id="inquiryContent" rows="3" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button type="button" onclick="closeInquiryModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ä¿å­˜</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast" class="fixed top-4 right-4 transform translate-x-full transition-transform duration-300 z-50">
      <div id="toastContent" class="rounded-lg shadow-lg p-4 min-w-64"></div>
    </div>
  </div>

  <script>
    let token = localStorage.getItem('token');
    let currentUser = null;
    let customersData = [];
    let productsData = [];

    // åˆå§‹åŒ–
    window.onload = () => {
      if (token) checkAuth();
    };

    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    async function checkAuth() {
      try {
        const res = await fetch('/api/me', { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if (data.success) {
          currentUser = data.user;
          showMainApp();
        } else {
          logout();
        }
      } catch (e) {
        logout();
      }
    }

    // ç™»å½•
    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        
        if (data.success) {
          token = data.token;
          currentUser = data.user;
          localStorage.setItem('token', token);
          showMainApp();
          showToast('success', 'ç™»å½•æˆåŠŸ');
        } else {
          showToast('error', data.message);
        }
      } catch (e) {
        showToast('error', 'ç™»å½•å¤±è´¥');
      }
    }

    // æ˜¾ç¤ºä¸»ç•Œé¢
    function showMainApp() {
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      document.getElementById('userName').textContent = currentUser.name;
      loadStats();
      loadCustomers();
      loadProducts();
    }

    // é€€å‡ºç™»å½•
    function logout() {
      token = null;
      currentUser = null;
      localStorage.removeItem('token');
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('mainApp').classList.add('hidden');
    }

    // é¡µé¢åˆ‡æ¢
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(page + 'Page').classList.remove('hidden');
      document.querySelectorAll('.sidebar-item').forEach((item, i) => {
        item.classList.remove('active');
        if ((page === 'dashboard' && i === 0) || (page === 'customers' && i === 1) || 
            (page === 'products' && i === 2) || (page === 'orders' && i === 3) || 
            (page === 'inquiries' && i === 4) || (page === 'ai' && i === 5)) {
          item.classList.add('active');
        }
      });
      if (page === 'dashboard') loadStats();
      if (page === 'customers') loadCustomers();
      if (page === 'products') loadProducts();
      if (page === 'orders') loadOrders();
      if (page === 'inquiries') loadInquiries();
      if (page === 'ai') loadApiKey();
    }

    // ==================== AIåŠŸèƒ½ ====================
    let savedApiKey = '';

    function loadApiKey() {
      const key = localStorage.getItem('deepseekApiKey');
      if (key) {
        savedApiKey = key;
        document.getElementById('deepseekApiKey').value = key;
      }
    }

    function saveApiKey() {
      const key = document.getElementById('deepseekApiKey').value.trim();
      if (!key) {
        showToast('error', 'è¯·è¾“å…¥API Key');
        return;
      }
      localStorage.setItem('deepseekApiKey', key);
      savedApiKey = key;
      showToast('success', 'API Keyä¿å­˜æˆåŠŸ');
    }

    function quickAsk(question) {
      document.getElementById('aiInput').value = question;
      sendAIMessage();
    }

    async function sendAIMessage() {
      const input = document.getElementById('aiInput');
      const message = input.value.trim();
      if (!message) return;

      if (!savedApiKey) {
        showToast('error', 'è¯·å…ˆä¿å­˜API Key');
        return;
      }

      const chatMessages = document.getElementById('aiChatMessages');
      
      chatMessages.innerHTML += `
        <div class="flex gap-3 justify-end">
          <div class="bg-blue-500 text-white rounded-lg p-3 max-w-[80%]">
            <p>${message}</p>
          </div>
          <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
            <i class="fas fa-user text-gray-600 text-sm"></i>
          </div>
        </div>
      `;

      input.value = '';
      chatMessages.scrollTop = chatMessages.scrollHeight;

      const loadingId = 'loading-' + Date.now();
      chatMessages.innerHTML += `
        <div id="${loadingId}" class="flex gap-3">
          <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
            <i class="fas fa-robot text-white text-sm"></i>
          </div>
          <div class="bg-gray-100 rounded-lg p-3">
            <p class="text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i>æ€è€ƒä¸­...</p>
          </div>
        </div>
      `;
      chatMessages.scrollTop = chatMessages.scrollHeight;

      try {
        const res = await fetch('/api/ai/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ message, apiKey: savedApiKey })
        });

        const data = await res.json();
        document.getElementById(loadingId).remove();

        if (data.success) {
          const formattedResponse = data.response.replace(/\n/g, '<br>');
          chatMessages.innerHTML += `
            <div class="flex gap-3">
              <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-robot text-white text-sm"></i>
              </div>
              <div class="bg-gray-100 rounded-lg p-3 max-w-[80%]">
                <p class="text-gray-700 whitespace-pre-wrap">${formattedResponse}</p>
              </div>
            </div>
          `;
        } else {
          chatMessages.innerHTML += `
            <div class="flex gap-3">
              <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-exclamation text-white text-sm"></i>
              </div>
              <div class="bg-red-50 rounded-lg p-3">
                <p class="text-red-600">${data.message}</p>
              </div>
            </div>
          `;
        }
      } catch (e) {
        document.getElementById(loadingId).remove();
        chatMessages.innerHTML += `
          <div class="flex gap-3">
            <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0">
              <i class="fas fa-exclamation text-white text-sm"></i>
            </div>
            <div class="bg-red-50 rounded-lg p-3">
              <p class="text-red-600">è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
            </div>
          </div>
        `;
      }

      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // åŠ è½½ç»Ÿè®¡æ•°æ®
    async function loadStats() {
      try {
        const res = await fetch('/api/stats', { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if (data.success) {
          document.getElementById('statCustomers').textContent = data.data.totalCustomers;
          document.getElementById('statOrders').textContent = data.data.totalOrders;
          document.getElementById('statInquiries').textContent = data.data.newInquiries;
          document.getElementById('statPending').textContent = data.data.pendingOrders;
          
          // æœ€è¿‘è®¢å•
          const ordersHtml = data.data.recentOrders.length ? 
            data.data.recentOrders.map(o => `
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="font-semibold">${o.id}</p>
                  <p class="text-sm text-gray-500">${o.customerName || 'æœªçŸ¥å®¢æˆ·'}</p>
                </div>
                <span class="px-2 py-1 rounded text-xs ${getStatusColor(o.status)}">${getStatusText(o.status)}</span>
              </div>
            `).join('') : '<p class="text-gray-500 text-center py-4">æš‚æ— è®¢å•</p>';
          document.getElementById('recentOrders').innerHTML = ordersHtml;
          
          // æœ€è¿‘è¯¢ç›˜
          const inquiriesHtml = data.data.recentInquiries.length ?
            data.data.recentInquiries.map(i => `
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="font-semibold">${i.customerName || 'æœªçŸ¥å®¢æˆ·'}</p>
                  <p class="text-sm text-gray-500">${i.productName || 'æœªçŸ¥äº§å“'}</p>
                </div>
                <span class="px-2 py-1 rounded text-xs ${getInquiryStatusColor(i.status)}">${getInquiryStatusText(i.status)}</span>
              </div>
            `).join('') : '<p class="text-gray-500 text-center py-4">æš‚æ— è¯¢ç›˜</p>';
          document.getElementById('recentInquiries').innerHTML = inquiriesHtml;
        }
      } catch (e) {
        console.error(e);
      }
    }

    // åŠ è½½å®¢æˆ·
    async function loadCustomers() {
      try {
        const search = document.getElementById('customerSearch')?.value || '';
        const status = document.getElementById('customerStatus')?.value || '';
        const type = document.getElementById('customerType')?.value || '';
        const level = document.getElementById('customerLevel')?.value || '';
        const res = await fetch(`/api/customers?search=${search}&status=${status}&type=${type}&level=${level}`, { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if (data.success) {
          customersData = data.data;
          const html = data.data.map(c => `
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-3">${c.name}</td>
              <td class="px-4 py-3">${c.company || '-'}</td>
              <td class="px-4 py-3">${c.country}</td>
              <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getCustomerTypeColor(c.type)}">${getCustomerTypeText(c.type)}</span></td>
              <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getCustomerLevelColor(c.level)}">${c.level || '-'}</span></td>
              <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getCustomerStatusColor(c.status)}">${getCustomerStatusText(c.status)}</span></td>
              <td class="px-4 py-3">
                <button onclick="editCustomer('${c.id}')" class="text-blue-600 hover:text-blue-800 mr-2"><i class="fas fa-edit"></i></button>
                <button onclick="deleteCustomer('${c.id}')" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
              </td>
            </tr>
          `).join('') || '<tr><td colspan="7" class="text-center py-4 text-gray-500">æš‚æ— å®¢æˆ·æ•°æ®</td></tr>';
          document.getElementById('customerList').innerHTML = html;
        }
      } catch (e) {
        console.error(e);
      }
    }

    function getCustomerTypeColor(type) {
      const colors = {
        'distributor': 'bg-purple-100 text-purple-700',
        'chassis': 'bg-blue-100 text-blue-700',
        'manufacturer': 'bg-green-100 text-green-700',
        'other': 'bg-gray-100 text-gray-700'
      };
      return colors[type] || 'bg-gray-100 text-gray-700';
    }

    function getCustomerTypeText(type) {
      const texts = {
        'distributor': 'åˆ†é”€å•†',
        'chassis': 'åº•ç›˜å•†',
        'manufacturer': 'åˆ¶é€ å•†',
        'other': 'å…¶ä»–'
      };
      return texts[type] || 'æœªåˆ†ç±»';
    }

    function getCustomerLevelColor(level) {
      const colors = {
        'A': 'bg-red-100 text-red-700',
        'B': 'bg-yellow-100 text-yellow-700',
        'C': 'bg-green-100 text-green-700'
      };
      return colors[level] || 'bg-gray-100 text-gray-700';
    }

    // åŠ è½½äº§å“
    async function loadProducts() {
      try {
        const res = await fetch('/api/products', { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if (data.success) {
          productsData = data.data;
          const html = data.data.map(p => `
            <div class="bg-gray-50 rounded-lg p-4 card-hover transition">
              <div class="flex justify-between items-start mb-2">
                <h4 class="font-bold text-gray-800">${p.name}</h4>
                <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">${p.category}</span>
              </div>
              <p class="text-sm text-gray-500 mb-2">${p.description || ''}</p>
              <div class="text-xs text-gray-400 space-y-1">
                <p><i class="fas fa-cog mr-1"></i>æè´¨: ${p.spec || '-'}</p>
                <p><i class="fas fa-ruler mr-1"></i>åšåº¦: ${p.thickness || '-'}</p>
                <p><i class="fas fa-arrows-alt-h mr-1"></i>å®½åº¦: ${p.width || '-'}</p>
              </div>
              <div class="flex justify-end mt-3 pt-3 border-t">
                <button onclick="editProduct('${p.id}')" class="text-blue-600 hover:text-blue-800 text-sm mr-3"><i class="fas fa-edit mr-1"></i>ç¼–è¾‘</button>
              </div>
            </div>
          `).join('');
          document.getElementById('productList').innerHTML = html;
        }
      } catch (e) {
        console.error(e);
      }
    }

    // åŠ è½½è®¢å•
    async function loadOrders() {
      try {
        const status = document.getElementById('orderStatus')?.value || '';
        const res = await fetch(`/api/orders?status=${status}`, { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if (data.success) {
          const html = data.data.map(o => `
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-3 font-mono">${o.id}</td>
              <td class="px-4 py-3">${o.customerName || '-'}</td>
              <td class="px-4 py-3">${o.productName || '-'}</td>
              <td class="px-4 py-3">${o.quantity} ${o.unit}</td>
              <td class="px-4 py-3">$${o.amount || 0}</td>
              <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getStatusColor(o.status)}">${getStatusText(o.status)}</span></td>
              <td class="px-4 py-3">
                <select onchange="updateOrderStatus('${o.id}', this.value)" class="text-sm border rounded px-2 py-1">
                  <option value="pending" ${o.status === 'pending' ? 'selected' : ''}>å¾…å¤„ç†</option>
                  <option value="confirmed" ${o.status === 'confirmed' ? 'selected' : ''}>å·²ç¡®è®¤</option>
                  <option value="producing" ${o.status === 'producing' ? 'selected' : ''}>ç”Ÿäº§ä¸­</option>
                  <option value="shipped" ${o.status === 'shipped' ? 'selected' : ''}>å·²å‘è´§</option>
                  <option value="completed" ${o.status === 'completed' ? 'selected' : ''}>å·²å®Œæˆ</option>
                </select>
              </td>
            </tr>
          `).join('') || '<tr><td colspan="7" class="text-center py-4 text-gray-500">æš‚æ— è®¢å•æ•°æ®</td></tr>';
          document.getElementById('orderList').innerHTML = html;
        }
      } catch (e) {
        console.error(e);
      }
    }

    // åŠ è½½è¯¢ç›˜
    async function loadInquiries() {
      try {
        const status = document.getElementById('inquiryStatus')?.value || '';
        const res = await fetch(`/api/inquiries?status=${status}`, { headers: { 'Authorization': `Bearer ${token}` } });
        const data = await res.json();
        if (data.success) {
          const html = data.data.map(i => `
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-3 font-mono">${i.id}</td>
              <td class="px-4 py-3">${i.customerName || '-'}</td>
              <td class="px-4 py-3">${i.productName || '-'}</td>
              <td class="px-4 py-3">${i.quantity || '-'} ${i.unit || ''}</td>
              <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs ${getInquiryStatusColor(i.status)}">${getInquiryStatusText(i.status)}</span></td>
              <td class="px-4 py-3">${new Date(i.createdAt).toLocaleDateString()}</td>
              <td class="px-4 py-3">
                <select onchange="updateInquiryStatus('${i.id}', this.value)" class="text-sm border rounded px-2 py-1">
                  <option value="new" ${i.status === 'new' ? 'selected' : ''}>æ–°è¯¢ç›˜</option>
                  <option value="processing" ${i.status === 'processing' ? 'selected' : ''}>å¤„ç†ä¸­</option>
                  <option value="quoted" ${i.status === 'quoted' ? 'selected' : ''}>å·²æŠ¥ä»·</option>
                  <option value="closed" ${i.status === 'closed' ? 'selected' : ''}>å·²å…³é—­</option>
                </select>
              </td>
            </tr>
          `).join('') || '<tr><td colspan="7" class="text-center py-4 text-gray-500">æš‚æ— è¯¢ç›˜æ•°æ®</td></tr>';
          document.getElementById('inquiryList').innerHTML = html;
        }
      } catch (e) {
        console.error(e);
      }
    }

    // çŠ¶æ€é¢œè‰²å’Œæ–‡æœ¬
    function getStatusColor(s) {
      const colors = { pending: 'bg-yellow-100 text-yellow-600', confirmed: 'bg-blue-100 text-blue-600', producing: 'bg-purple-100 text-purple-600', shipped: 'bg-indigo-100 text-indigo-600', completed: 'bg-green-100 text-green-600' };
      return colors[s] || 'bg-gray-100 text-gray-600';
    }
    function getStatusText(s) {
      const texts = { pending: 'å¾…å¤„ç†', confirmed: 'å·²ç¡®è®¤', producing: 'ç”Ÿäº§ä¸­', shipped: 'å·²å‘è´§', completed: 'å·²å®Œæˆ' };
      return texts[s] || s;
    }
    function getInquiryStatusColor(s) {
      const colors = { new: 'bg-red-100 text-red-600', processing: 'bg-yellow-100 text-yellow-600', quoted: 'bg-blue-100 text-blue-600', closed: 'bg-gray-100 text-gray-600' };
      return colors[s] || 'bg-gray-100 text-gray-600';
    }
    function getInquiryStatusText(s) {
      const texts = { new: 'æ–°è¯¢ç›˜', processing: 'å¤„ç†ä¸­', quoted: 'å·²æŠ¥ä»·', closed: 'å·²å…³é—­' };
      return texts[s] || s;
    }
    function getCustomerStatusColor(s) {
      const colors = { active: 'bg-green-100 text-green-600', inactive: 'bg-gray-100 text-gray-600', potential: 'bg-blue-100 text-blue-600' };
      return colors[s] || 'bg-gray-100 text-gray-600';
    }
    function getCustomerStatusText(s) {
      const texts = { active: 'æ´»è·ƒ', inactive: 'ä¸æ´»è·ƒ', potential: 'æ½œåœ¨' };
      return texts[s] || s;
    }

    // å®¢æˆ·æ“ä½œ
    function showCustomerModal(id = null) {
      document.getElementById('customerModal').classList.remove('hidden');
      document.getElementById('customerModalTitle').textContent = id ? 'ç¼–è¾‘å®¢æˆ·' : 'æ·»åŠ å®¢æˆ·';
      document.getElementById('customerId').value = id || '';
      if (id) {
        const c = customersData.find(x => x.id === id);
        if (c) {
          document.getElementById('customerName').value = c.name;
          document.getElementById('customerCompany').value = c.company || '';
          document.getElementById('customerCountry').value = c.country;
          document.getElementById('customerStatusInput').value = c.status || 'potential';
          document.getElementById('customerTypeInput').value = c.type || '';
          document.getElementById('customerLevelInput').value = c.level || '';
          document.getElementById('customerEmail').value = c.email || '';
          document.getElementById('customerPhone').value = c.phone || '';
          document.getElementById('customerAddress').value = c.address || '';
          document.getElementById('customerNotes').value = c.notes || '';
        }
      } else {
        document.getElementById('customerName').value = '';
        document.getElementById('customerCompany').value = '';
        document.getElementById('customerCountry').value = '';
        document.getElementById('customerStatusInput').value = 'potential';
        document.getElementById('customerTypeInput').value = '';
        document.getElementById('customerLevelInput').value = '';
        document.getElementById('customerEmail').value = '';
        document.getElementById('customerPhone').value = '';
        document.getElementById('customerAddress').value = '';
        document.getElementById('customerNotes').value = '';
      }
    }
    function closeCustomerModal() { document.getElementById('customerModal').classList.add('hidden'); }
    function editCustomer(id) { showCustomerModal(id); }
    async function saveCustomer(e) {
      e.preventDefault();
      const id = document.getElementById('customerId').value;
      const data = {
        name: document.getElementById('customerName').value,
        company: document.getElementById('customerCompany').value,
        country: document.getElementById('customerCountry').value,
        status: document.getElementById('customerStatusInput').value,
        type: document.getElementById('customerTypeInput').value,
        level: document.getElementById('customerLevelInput').value,
        email: document.getElementById('customerEmail').value,
        phone: document.getElementById('customerPhone').value,
        address: document.getElementById('customerAddress').value,
        notes: document.getElementById('customerNotes').value
      };
      try {
        const res = await fetch(`/api/customers${id ? '/' + id : ''}`, {
          method: id ? 'PUT' : 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          closeCustomerModal();
          loadCustomers();
          showToast('success', id ? 'å®¢æˆ·æ›´æ–°æˆåŠŸ' : 'å®¢æˆ·æ·»åŠ æˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'æ“ä½œå¤±è´¥');
      }
    }
    async function deleteCustomer(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®¢æˆ·å—ï¼Ÿ')) return;
      try {
        const res = await fetch(`/api/customers/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
        const result = await res.json();
        if (result.success) {
          loadCustomers();
          showToast('success', 'å®¢æˆ·åˆ é™¤æˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'åˆ é™¤å¤±è´¥');
      }
    }

    // äº§å“æ“ä½œ
    function showProductModal(id = null) {
      document.getElementById('productModal').classList.remove('hidden');
      document.getElementById('productModalTitle').textContent = id ? 'ç¼–è¾‘äº§å“' : 'æ·»åŠ äº§å“';
      document.getElementById('productId').value = id || '';
      if (id) {
        const p = productsData.find(x => x.id === id);
        if (p) {
          document.getElementById('productName').value = p.name;
          document.getElementById('productCategory').value = p.category;
          document.getElementById('productSpec').value = p.spec || '';
          document.getElementById('productThickness').value = p.thickness || '';
          document.getElementById('productWidth').value = p.width || '';
          document.getElementById('productDescription').value = p.description || '';
        }
      } else {
        document.getElementById('productName').value = '';
        document.getElementById('productCategory').value = 'é‡å‹è½¦ç³»åˆ—';
        document.getElementById('productSpec').value = '';
        document.getElementById('productThickness').value = '';
        document.getElementById('productWidth').value = '';
        document.getElementById('productDescription').value = '';
      }
    }
    function closeProductModal() { document.getElementById('productModal').classList.add('hidden'); }
    function editProduct(id) { showProductModal(id); }
    async function saveProduct(e) {
      e.preventDefault();
      const id = document.getElementById('productId').value;
      const data = {
        name: document.getElementById('productName').value,
        category: document.getElementById('productCategory').value,
        spec: document.getElementById('productSpec').value,
        thickness: document.getElementById('productThickness').value,
        width: document.getElementById('productWidth').value,
        description: document.getElementById('productDescription').value
      };
      try {
        const res = await fetch(`/api/products${id ? '/' + id : ''}`, {
          method: id ? 'PUT' : 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          closeProductModal();
          loadProducts();
          showToast('success', id ? 'äº§å“æ›´æ–°æˆåŠŸ' : 'äº§å“æ·»åŠ æˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'æ“ä½œå¤±è´¥');
      }
    }

    // è®¢å•æ“ä½œ
    function showOrderModal() {
      document.getElementById('orderModal').classList.remove('hidden');
      const customerSelect = document.getElementById('orderCustomer');
      const productSelect = document.getElementById('orderProduct');
      customerSelect.innerHTML = customersData.map(c => `<option value="${c.id}">${c.name} (${c.country})</option>`).join('');
      productSelect.innerHTML = productsData.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }
    function closeOrderModal() { document.getElementById('orderModal').classList.add('hidden'); }
    async function saveOrder(e) {
      e.preventDefault();
      const customerId = document.getElementById('orderCustomer').value;
      const productId = document.getElementById('orderProduct').value;
      const customer = customersData.find(c => c.id === customerId);
      const product = productsData.find(p => p.id === productId);
      
      const data = {
        customerId,
        customerName: customer?.name,
        productId,
        productName: product?.name,
        quantity: document.getElementById('orderQuantity').value,
        unit: document.getElementById('orderUnit').value,
        price: document.getElementById('orderPrice').value,
        amount: document.getElementById('orderAmount').value,
        notes: document.getElementById('orderNotes').value
      };
      try {
        const res = await fetch('/api/orders', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          closeOrderModal();
          loadOrders();
          showToast('success', 'è®¢å•åˆ›å»ºæˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'æ“ä½œå¤±è´¥');
      }
    }
    async function updateOrderStatus(id, status) {
      try {
        const res = await fetch(`/api/orders/${id}/status`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ status })
        });
        const result = await res.json();
        if (result.success) {
          showToast('success', 'çŠ¶æ€æ›´æ–°æˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'æ›´æ–°å¤±è´¥');
      }
    }

    // è¯¢ç›˜æ“ä½œ
    function showInquiryModal() {
      document.getElementById('inquiryModal').classList.remove('hidden');
      const customerSelect = document.getElementById('inquiryCustomer');
      const productSelect = document.getElementById('inquiryProduct');
      customerSelect.innerHTML = customersData.map(c => `<option value="${c.id}">${c.name} (${c.country})</option>`).join('');
      productSelect.innerHTML = productsData.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }
    function closeInquiryModal() { document.getElementById('inquiryModal').classList.add('hidden'); }
    async function saveInquiry(e) {
      e.preventDefault();
      const customerId = document.getElementById('inquiryCustomer').value;
      const productId = document.getElementById('inquiryProduct').value;
      const customer = customersData.find(c => c.id === customerId);
      const product = productsData.find(p => p.id === productId);
      
      const data = {
        customerId,
        customerName: customer?.name,
        productId,
        productName: product?.name,
        quantity: document.getElementById('inquiryQuantity').value,
        unit: document.getElementById('inquiryUnit').value,
        content: document.getElementById('inquiryContent').value
      };
      try {
        const res = await fetch('/api/inquiries', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.success) {
          closeInquiryModal();
          loadInquiries();
          showToast('success', 'è¯¢ç›˜æ·»åŠ æˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'æ“ä½œå¤±è´¥');
      }
    }
    async function updateInquiryStatus(id, status) {
      try {
        const res = await fetch(`/api/inquiries/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ status })
        });
        const result = await res.json();
        if (result.success) {
          showToast('success', 'çŠ¶æ€æ›´æ–°æˆåŠŸ');
        } else {
          showToast('error', result.message);
        }
      } catch (e) {
        showToast('error', 'æ›´æ–°å¤±è´¥');
      }
    }

    // Toastæç¤º
    function showToast(type, message) {
      const toast = document.getElementById('toast');
      const content = document.getElementById('toastContent');
      const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
      const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
      content.className = `${bgColor} rounded-lg shadow-lg p-4 min-w-64 text-white flex items-center`;
      content.innerHTML = `<i class="fas ${icon} mr-3 text-xl"></i><span>${message}</span>`;
      toast.classList.remove('translate-x-full');
      setTimeout(() => toast.classList.add('translate-x-full'), 3000);
    }
  </script>
</body>
</html>